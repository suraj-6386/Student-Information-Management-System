=====================================
MYSQL DATABASE REFERENCE
Student Information Management System v2.0
=====================================
Date: February 27, 2026
=====================================

=====================================
DATABASE SETUP STATUS
=====================================

✅ DATABASE SCHEMA: COMPLETE AND CORRECT
✅ NO MYSQL CHANGES REQUIRED

The database structure from SQL_UPDATES.txt is FINAL and VALID.
All JSP compilation errors have been fixed (no schema changes needed).


=====================================
MYSQL CONFIGURATION
=====================================

DATABASE NAME: student_management
MYSQL USER: root
MYSQL PASSWORD: 15056324
HOST: localhost:3306
PORT: 3306

CONNECTION STRING (For Java/JSP):
jdbc:mysql://localhost:3306/student_management?useSSL=false&serverTimezone=UTC


=====================================
COMPLETE SCHEMA OVERVIEW
=====================================

TOTAL TABLES: 8 (7 main + 1 system)

TABLE STRUCTURE:

1. SUBJECTS TABLE (6 Default Subjects)
   ├─ subject_id (INT, PRIMARY KEY, AUTO_INCREMENT)
   ├─ subject_name (VARCHAR 100, UNIQUE NOT NULL)
   └─ created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
   
   All Students Must Have These 6 Subjects:
   1. Advanced Java
   2. DBMS
   3. AI
   4. ReactJS
   5. Research Methodology
   6. German Language

2. STUDENTS TABLE (Self-Registered)
   ├─ student_id (INT, PRIMARY KEY, AUTO_INCREMENT)
   ├─ name (VARCHAR 100 NOT NULL)
   ├─ course (VARCHAR 50 NOT NULL)
   ├─ semester (VARCHAR 20 NOT NULL)
   ├─ email (VARCHAR 100 UNIQUE NOT NULL)
   ├─ phone (VARCHAR 15 NOT NULL)
   └─ created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)

3. TEACHERS TABLE (Self-Registered)
   ├─ teacher_id (INT, PRIMARY KEY, AUTO_INCREMENT)
   ├─ name (VARCHAR 100 NOT NULL)
   ├─ subject (VARCHAR 50 NOT NULL)
   ├─ email (VARCHAR 100 UNIQUE NOT NULL)
   ├─ phone (VARCHAR 15)
   └─ created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)

4. LOGIN TABLE (Authentication)
   ├─ id (INT, PRIMARY KEY, AUTO_INCREMENT)
   ├─ username (VARCHAR 50 UNIQUE NOT NULL)
   ├─ password (VARCHAR 50 NOT NULL)
   ├─ role (VARCHAR 20 NOT NULL) [Values: admin, student, teacher]
   ├─ student_id (INT, FOREIGN KEY → students.student_id, nullable, SET NULL on delete)
   ├─ teacher_id (INT, FOREIGN KEY → teachers.teacher_id, nullable, SET NULL on delete)
   └─ created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)

5. MARKS TABLE (6 Records Per Student)
   ├─ mark_id (INT, PRIMARY KEY, AUTO_INCREMENT)
   ├─ student_id (INT, FOREIGN KEY → students.student_id, CASCADE on delete)
   ├─ subject_id (INT, FOREIGN KEY → subjects.subject_id, CASCADE on delete)
   ├─ subject (VARCHAR 100 NOT NULL)
   ├─ marks (INT DEFAULT 0) [Range: 0-100, 0 = Not Entered Yet]
   └─ created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)

6. ATTENDANCE TABLE (Multiple Records Per Student Per Subject)
   ├─ attendance_id (INT, PRIMARY KEY, AUTO_INCREMENT)
   ├─ student_id (INT, FOREIGN KEY → students.student_id, CASCADE on delete)
   ├─ subject_id (INT, FOREIGN KEY → subjects.subject_id, CASCADE on delete)
   ├─ subject (VARCHAR 100 NOT NULL)
   ├─ date (DATE NOT NULL)
   ├─ status (VARCHAR 10 NOT NULL) [Values: Present, Absent ONLY]
   └─ created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)

7. TEACHER_SUBJECTS TABLE (Many-to-Many Relationship)
   ├─ teacher_subject_id (INT, PRIMARY KEY, AUTO_INCREMENT)
   ├─ teacher_id (INT, FOREIGN KEY → teachers.teacher_id, CASCADE on delete)
   ├─ subject_id (INT, FOREIGN KEY → subjects.subject_id, CASCADE on delete)
   ├─ created_at (TIMESTAMP DEFAULT CURRENT_TIMESTAMP)
   └─ UNIQUE(teacher_id, subject_id)

8. VIEWS (3 Helper Views for Queries)
   ├─ student_login_view
   ├─ teacher_login_view
   └─ teacher_subject_view


=====================================
FOREIGN KEY RELATIONSHIPS
=====================================

FK1: login.student_id → students.student_id
     Action on Delete: SET NULL
     Reason: When student deleted, keep login record with NULL student_id

FK2: login.teacher_id → teachers.teacher_id
     Action on Delete: SET NULL
     Reason: When teacher deleted, keep login record with NULL teacher_id

FK3: marks.student_id → students.student_id
     Action on Delete: CASCADE
     Reason: Delete all mark records when student deleted

FK4: marks.subject_id → subjects.subject_id
     Action on Delete: CASCADE
     Reason: Delete all marks for subject when subject deleted (Rare)

FK5: attendance.student_id → students.student_id
     Action on Delete: CASCADE
     Reason: Delete all attendance records when student deleted

FK6: attendance.subject_id → subjects.subject_id
     Action on Delete: CASCADE
     Reason: Delete all attendance for subject when subject deleted (Rare)

FK7: teacher_subjects.teacher_id → teachers.teacher_id
     Action on Delete: CASCADE
     Reason: Delete teacher-subject assignment when teacher deleted

FK8: teacher_subjects.subject_id → subjects.subject_id
     Action on Delete: CASCADE
     Reason: Delete teacher assignments when subject deleted (Rare)


=====================================
INDEXES (Performance Optimization)
=====================================

LOGIN TABLE:
  ✓ idx_login_username (UNIQUE) - For fast login lookups
  ✓ idx_login_role - For filtering by role
  ✓ idx_login_student_id - For finding student login record
  ✓ idx_login_teacher_id - For finding teacher login record

STUDENTS/TEACHERS TABLES:
  ✓ idx_students_email (UNIQUE) - Prevent duplicate registration
  ✓ idx_teachers_email (UNIQUE) - Prevent duplicate registration

MARKS TABLE:
  ✓ idx_marks_student - For querying marks by student
  ✓ idx_marks_subject - For querying marks by subject

ATTENDANCE TABLE:
  ✓ idx_attendance_student - For querying attendance by student
  ✓ idx_attendance_subject - For querying attendance by subject
  ✓ idx_attendance_date - For date-range queries

TEACHER_SUBJECTS TABLE:
  ✓ idx_teacher_subjects_teacher - For finding subjects taught by teacher
  ✓ idx_teacher_subjects_subject - For finding teachers teaching subject


=====================================
MYSQL VERIFICATION QUERIES
=====================================

EXECUTE THESE TO VERIFY DATABASE SETUP:

1. CHECK ALL TABLES EXIST:
   SHOW TABLES IN student_management;
   
   Expected Output: 8 rows (all tables listed)

2. VERIFY 6 SUBJECTS CREATED:
   SELECT * FROM subjects;
   
   Expected Output:
   ┌────────────┬────────────────────┐
   │ subject_id │ subject_name       │
   ├────────────┼────────────────────┤
   │ 1          │ Advanced Java      │
   │ 2          │ DBMS               │
   │ 3          │ AI                 │
   │ 4          │ ReactJS            │
   │ 5          │ Research Method... │
   │ 6          │ German Language    │
   └────────────┴────────────────────┘

3. CHECK ADMIN ACCOUNT:
   SELECT id, username, password, role, student_id, teacher_id FROM login WHERE role='admin';
   
   Expected Output:
   ┌────┬──────────┬────────────┬───────┬────────────┬────────────┐
   │ id │ username │ password   │ role  │ student_id │ teacher_id │
   ├────┼──────────┼────────────┼───────┼────────────┼────────────┤
   │ 1  │ admin    │ admin123   │ admin │ NULL       │ NULL       │
   └────┴──────────┴────────────┴───────┴────────────┴────────────┘

4. VERIFY SAMPLE STUDENTS:
   SELECT student_id, name, course, semester, email FROM students LIMIT 5;
   
   Expected Output: 5 rows with student data

5. VERIFY SAMPLE TEACHERS:
   SELECT teacher_id, name, subject, email FROM teachers LIMIT 3;
   
   Expected Output: 3 rows with teacher data

6. VERIFY STUDENT MARKS (Sample student_id=1):
   SELECT mark_id, student_id, subject_id, subject, marks FROM marks WHERE student_id=1 ORDER BY subject_id;
   
   Expected Output: 6 rows (one per subject, marks values 0-100)

7. VERIFY STUDENT ATTENDANCE (Sample student_id=1):
   SELECT attendance_id, student_id, subject_id, subject, date, status FROM attendance WHERE student_id=1 ORDER BY date DESC;
   
   Expected Output: Multiple rows with dates, subjects, and status

8. VERIFY TEACHER-SUBJECT ASSIGNMENTS:
   SELECT ts.teacher_subject_id, t.name AS teacher, s.subject_name AS subject
   FROM teacher_subjects ts
   INNER JOIN teachers t ON ts.teacher_id = t.teacher_id
   INNER JOIN subjects s ON ts.subject_id = s.subject_id
   ORDER BY t.teacher_id, s.subject_id;
   
   Expected Output: 6 rows (each teacher assigned 2 subjects)

9. CHECK FOREIGN KEY CONSTRAINTS:
   SELECT CONSTRAINT_NAME, COLUMN_NAME, REFERENCED_TABLE_NAME, REFERENCED_COLUMN_NAME 
   FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE 
   WHERE TABLE_NAME IN ('login', 'marks', 'attendance', 'teacher_subjects')
   AND REFERENCED_TABLE_NAME IS NOT NULL
   ORDER BY TABLE_NAME, CONSTRAINT_NAME;
   
   Expected Output: 8 rows (all FKs defined correctly)

10. VERIFY INDEXES:
    SHOW INDEX FROM login;
    SHOW INDEX FROM marks;
    SHOW INDEX FROM attendance;
    
    Expected Output: All indexes listed and active


=====================================
COMMON QUERIES FOR DEVELOPMENT
=====================================

GET STUDENT LOGIN INFO:
SELECT l.id, l.username, l.role, s.student_id, s.name, s.email, s.course
FROM login l
LEFT JOIN students s ON l.student_id = s.student_id
WHERE l.role = 'student'
ORDER BY s.name;

GET TEACHER LOGIN INFO:
SELECT l.id, l.username, l.role, t.teacher_id, t.name, t.email, t.subject
FROM login l
LEFT JOIN teachers t ON l.teacher_id = t.teacher_id
WHERE l.role = 'teacher'
ORDER BY t.name;

GET ALL STUDENTS IN A COURSE:
SELECT student_id, name, semester, email, phone
FROM students
WHERE course='B.Tech'
ORDER BY name;

GET MARKS PER STUDENT:
SELECT student_id, subject, marks
FROM marks
WHERE student_id=1
ORDER BY subject;

GET ATTENDANCE COUNT PER STUDENT (PRESENT/ABSENT):
SELECT 
    student_id,
    subject,
    COUNT(*) as total_classes,
    SUM(CASE WHEN status='Present' THEN 1 ELSE 0 END) as present_count,
    SUM(CASE WHEN status='Absent' THEN 1 ELSE 0 END) as absent_count,
    ROUND(100.0 * SUM(CASE WHEN status='Present' THEN 1 ELSE 0 END) / COUNT(*), 2) as percentage
FROM attendance
WHERE student_id=1
GROUP BY subject
ORDER BY subject;

GET TEACHERS FOR A SUBJECT:
SELECT DISTINCT t.teacher_id, t.name, t.email
FROM teachers t
INNER JOIN teacher_subjects ts ON t.teacher_id = ts.teacher_id
INNER JOIN subjects s ON ts.subject_id = s.subject_id
WHERE s.subject_name='Advanced Java'
ORDER BY t.name;

GET SUBJECTS TAUGHT BY A TEACHER:
SELECT DISTINCT s.subject_id, s.subject_name
FROM subjects s
INNER JOIN teacher_subjects ts ON s.subject_id = ts.subject_id
WHERE ts.teacher_id=1
ORDER BY s.subject_name;

GET STUDENTS WITH LOW ATTENDANCE:
SELECT DISTINCT a.student_id, s.name, a.subject, 
       ROUND(100.0 * SUM(CASE WHEN a.status='Present' THEN 1 ELSE 0 END) / COUNT(*), 2) as attendance_percentage
FROM attendance a
INNER JOIN students s ON a.student_id = s.student_id
GROUP BY a.student_id, a.subject
HAVING attendance_percentage < 75
ORDER BY attendance_percentage;

FIND DUPLICATE USERNAMES:
SELECT username, COUNT(*) as count
FROM login
GROUP BY username
HAVING COUNT(*) > 1;

GET RECENT MARK ENTRIES:
SELECT m.mark_id, s.name, m.subject, m.marks, m.created_at
FROM marks m
INNER JOIN students s ON m.student_id = s.student_id
WHERE m.marks > 0
ORDER BY m.created_at DESC
LIMIT 10;


=====================================
BACKUP AND RESTORE
=====================================

BACKUP DATABASE:
mysqldump -u root -p15056324 student_management > student_management_backup.sql

Command (No password prompt):
mysqldump --user=root --password=15056324 student_management > C:\backups\student_management_backup.sql

RESTORE DATABASE:
mysql -u root -p15056324 student_management < student_management_backup.sql

Or in MySQL Workbench:
Server → Data Export → Select database → Execute
Server → Data Import/Restore → Select backup file → Execute


=====================================
TROUBLESHOOTING - MYSQL ISSUES
=====================================

ERROR: "Access denied for user 'root'@'localhost'"
SOLUTION: Check MySQL password in DBConnection.jsp
- Should be: "15056324"
- Verify MySQL server is running: C:\xampp\mysql\bin\mysqld.exe

ERROR: "Unknown database 'student_management'"
SOLUTION: Execute SQL_UPDATES.txt STEP 1 (CREATE DATABASE)

ERROR: "Field 'subject_id' doesn't have a default value"
SOLUTION: ✅ FIXED in registration.jsp
- Was: Not providing subject_id in INSERT statement
- Now: Queries all 6 subject_ids and includes in INSERT

ERROR: "Duplicate entry for key 'username'"
SOLUTION: 
- Two user registrations with same username
- TRUNCATE login; TRUNCATE students; TRUNCATE teachers;
- Restart application and re-register

ERROR: "Foreign key constraint fails"
SOLUTION: Execute tables in correct order (FK dependencies):
1. subjects
2. students, teachers
3. login (FKs to students/teachers)
4. marks (FKs to students/subjects)
5. attendance (FKs to students/subjects)
6. teacher_subjects (FKs to teachers/subjects)

ERROR: "No database selected"
SOLUTION: Add "USE student_management;" at top of query


=====================================
PERFORMANCE OPTIMIZATION TIPS
=====================================

CURRENT STATUS: ✅ OPTIMIZED
- All necessary indexes created
- Foreign keys properly configured
- Views available for complex queries

FOR LARGE SCALE (1000+ students):

1. Add compound indexes:
   CREATE INDEX idx_marks_student_subject ON marks(student_id, subject_id);
   CREATE INDEX idx_attendance_student_subject ON attendance(student_id, subject_id);

2. Archive old attendance records:
   CREATE TABLE attendance_archive LIKE attendance;
   INSERT INTO attendance_archive SELECT * FROM attendance WHERE year(date) < 2025;
   DELETE FROM attendance WHERE year(date) < 2025;

3. Add statistics:
   ANALYZE TABLE subjects;
   ANALYZE TABLE students;
   ANALYZE TABLE marks;
   ANALYZE TABLE attendance;

4. Monitor slow queries:
   SET GLOBAL slow_query_log = 'ON';
   SET GLOBAL long_query_time = 2;


=====================================
DATABASE STATISTICS
=====================================

After Setup (With Sample Data):

TABLES:
- subjects: 6 rows
- students: 5 rows (sample)
- teachers: 3 rows (sample)
- login: 9 rows (1 admin + 5 students + 3 teachers)
- marks: 30 rows (5 students × 6 subjects)
- attendance: ~9-20 rows (sample data provided)
- teacher_subjects: 6 rows (3 teachers × 2 subjects each)
- Plus 3 helper views

TOTAL RECORDS: ~60-70 initial records (grows with usage)

STORAGE: ~200-300 KB (minimal storage requirement)
GROWTH RATE: ~500 bytes per marks entry, ~100 bytes per attendance entry


=====================================
MIGRATION NOTES
=====================================

IF MIGRATING FROM OLD DATABASE:

Old Schema Issues (Fixed in v2.0):
✗ No subjects table (6 default subjects not enforced)
✗ Attendance without subject tracking
✗ Marks table incomplete
✗ No teacher-subject relationships
✗ Admin could add students manually

New Schema Improvements (v2.0):
✓ subjects table with 6 mandatory subjects
✓ Attendance per subject (college format)
✓ Marks per subject from registration
✓ Teacher-subject many-to-many relationships
✓ Self-registration for students and teachers
✓ Admin can only edit existing students

MIGRATION STEPS:
1. Backup old database: mysqldump olddb > olddb_backup.sql
2. Create new database: Execute SQL_UPDATES.txt
3. Migrate student data: INSERT INTO students SELECT ... FROM old_students;
4. Migrate teacher data: INSERT INTO teachers SELECT ... FROM old_teachers;
5. Adjust login records: Re-create with new role system
6. Test thoroughly before deploying


=====================================
SECURITY NOTES
=====================================

DATABASE SECURITY:
✓ User 'root' with password protection
✓ Foreign key constraints prevent orphaned records
✓ Indexes support fast queries (prevent abuse)
✓ Proper data types prevent injection (prepared statements in JSP)

APPLICATION SECURITY:
✓ PreparedStatement in all JSP queries (prevent SQL injection)
✓ Session-based authentication (secure login)
✓ Role-based access control (admin/teacher/student)
✓ Password stored in login table (should be hashed in production)
✓ HTTPS recommended for production

RECOMMENDATIONS FOR PRODUCTION:
1. Use bcrypt for password hashing instead of plaintext
2. Enable HTTPS/SSL
3. Regular database backups
4. Monitor login attempts for brute force
5. Add audit logging for data changes
6. Implement CSRF protection
7. Set password expiry policies
8. Use connection pooling for better performance


=====================================
DATABASE READY FOR DEPLOYMENT
=====================================

✅ Schema: COMPLETE
✅ Constraints: CONFIGURED
✅ Indexes: CREATED
✅ Views: DEFINED
✅ Sample Data: PROVIDED
✅ Foreign Keys: ACTIVE
✅ Performance: OPTIMIZED

Execute SQL_UPDATES.txt and start using the system!

NO MYSQL CHANGES ARE REQUIRED.
The current schema supports all features.

=====================================
